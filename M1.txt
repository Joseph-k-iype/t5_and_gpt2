from pptx.oxml import parse_xml
from pptx.oxml.ns import nsdecls

def add_thick_border_to_row(table, row_index):
    """
    Add a thick border to the bottom of each cell in the specified row of the table.
    """
    for cell in table.rows[row_index].cells:
        tc = cell._tc  # Get the underlying XML element for the cell
        tcPr = tc.get_or_add_tcPr()  # Get or add the <w:tcPr> element
        # Define the border XML
        tcPr.append(parse_xml(f'''
            <a:lnB {nsdecls("a")} w="12700">
                <a:solidFill>
                    <a:srgbClr val="000000"/>
                </a:solidFill>
                <a:prstDash val="solid"/>
            </a:lnB>
        '''))


# Populate Slide 6
def populate_slide_6(slide, df):
    delete_existing_tables(slide)
    headers = ["Process", "Consumed or Produced", "Business", "Process Owner", "Total Metrics", "BDEs at Boundary Level", "Pass Through BDEs", "Pass Through Metrics"]
    table = create_table(slide, headers, num_rows=1 + 2 * df['Process'].nunique(), top_position=Inches(1))

    row_data = []
    for process in df['Process'].unique():
        process_data = df[df['Process'] == process]

        # Add rows for consumed data
        row_data.append([process, 'Consumed', ...])  # Include all consumed data here
        row_data.append([process, 'Produced', ...])  # Include all produced data here

    populate_table(table, row_data)

    # Add thick borders after every 2 rows (1 for consumed, 1 for produced)
    for i in range(2, len(row_data) + 1, 2):  # Every 2 rows
        add_thick_border_to_row(table, i - 1)


# Populate Slide 8
def populate_slide_8(slide, df, csv_data):
    delete_existing_tables(slide)
    headers = [
        "Process", "Consumed or Produced", "Total BDEs", "Total BDEs Agreed to Monitor", "% BDE Monitored",
        "BDEs at Boundary Level", "Boundary BDEs Agreed to Monitor", "% Boundary BDE Monitored",
        "Pass Through BDEs", "Pass Through BDEs Agreed to Monitor", "% Pass Through BDE Monitored",
        "Total Metrics", "Total Metrics Agreed to Monitor", "% Metrics Monitored",
        "Pass Through Metrics", "Pass Through Metrics Agreed to Monitor", "% Pass Through Metrics Monitored"
    ]
    table = create_table(slide, headers, num_rows=1 + 2 * df['Process'].nunique(), top_position=Inches(1))

    row_data = []
    for process in df['Process'].unique():
        process_data = df[df['Process'] == process]

        # Add rows for consumed data
        row_data.append([process, 'Consumed', ...])  # Include all consumed data here
        row_data.append([process, 'Produced', ...])  # Include all produced data here

    populate_table(table, row_data)

    # Add thick borders after every 2 rows (1 for consumed, 1 for produced)
    for i in range(2, len(row_data) + 1, 2):  # Every 2 rows
        add_thick_border_to_row(table, i - 1)
