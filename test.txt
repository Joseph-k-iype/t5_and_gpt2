import os
import pandas as pd

def merge_and_split_csv_files(input_folder, output_folder, rows_per_file=1048576):
    # Get a list of all CSV files in the input folder
    csv_files = [file for file in os.listdir(input_folder) if file.endswith('.csv')]
    
    # Initialize a list to hold dataframes
    df_list = []
    
    # Loop through the list of CSV files and read them into dataframes
    for csv_file in csv_files:
        file_path = os.path.join(input_folder, csv_file)
        try:
            df = pd.read_csv(file_path)
            df_list.append(df)
        except Exception as e:
            print(f"Error reading {file_path}: {e}")
    
    # Concatenate all dataframes into one
    if df_list:
        merged_df = pd.concat(df_list, ignore_index=True)
        
        # Split the merged dataframe into multiple CSV files
        num_files = (len(merged_df) // rows_per_file) + 1
        for i in range(num_files):
            start_row = i * rows_per_file
            end_row = min(start_row + rows_per_file, len(merged_df))
            output_file = os.path.join(output_folder, f'merged_file_part_{i+1}.csv')
            merged_df.iloc[start_row:end_row].to_csv(output_file, index=False)
            print(f"Saved {output_file} with rows from {start_row} to {end_row}")
    else:
        print("No valid CSV files found to merge.")

# Usage example
input_folder = 'path/to/your/folder'
output_folder = 'path/to/output/folder'
merge_and_split_csv_files(input_folder, output_folder)
