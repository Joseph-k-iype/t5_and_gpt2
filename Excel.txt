import json
import csv

# Load JSON data from file
json_file = "results.json"
csv_file = "output.csv"

with open(json_file, "r", encoding="utf-8") as file:
    data = json.load(file)

# Define CSV headers
headers = [
    "index",
    "input_name",
    "input_definition",
    "rating",
    "reason",
    "match_name",
    "match_definition",
    "confidence",
    "match_rating",
    "match_reason",
    "metadata_definition",
    "metadata_id",
    "metadata_name"
]

# Write CSV file
with open(csv_file, mode="w", newline="", encoding="utf-8") as file:
    writer = csv.writer(file)
    writer.writerow(headers)  # Write header row

    for entry in data:
        index = entry.get("index")
        input_name = entry["input"].get("name", "")
        input_definition = entry["input"].get("definition", "")
        rating = entry.get("rating", "")
        reason = entry.get("reason", "")

        # Iterate over matches
        for match in entry.get("matches", []):
            match_name = match.get("name", "")
            match_definition = match.get("definition", "")
            confidence = match.get("confidence", "")
            match_rating = match.get("rating", "")
            match_reason = match.get("reason", "")

            metadata = match.get("metadata", {})
            metadata_definition = metadata.get("definition", "")
            metadata_id = metadata.get("id", "")
            metadata_name = metadata.get("name", "")

            writer.writerow([
                index,
                input_name,
                input_definition,
                rating,
                reason,
                match_name,
                match_definition,
                confidence,
                match_rating,
                match_reason,
                metadata_definition,
                metadata_id,
                metadata_name
            ])

print(f"CSV file '{csv_file}' created successfully.")
