PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX ex: <http://example.org/>

CONSTRUCT {
    # Return the filtered instances and their connections
    ?class1Instance rdf:type ex:Class1 .
    ?class1Instance ex:predicate1 ?class2Instance .
    ?class2Instance rdf:type ex:Class2 .
    ?class2Instance ex:predicate2 ?class3Instance .
    ?class3Instance rdf:type ex:Class3 .
    
    # Include additional properties if needed
    ?class1Instance ex:property1 ?value1 .
    ?class2Instance ex:property2 ?value2 .
    ?class3Instance ex:property3 ?value3 .
}
WHERE {
    # Class 1 with filter
    ?class1Instance rdf:type ex:Class1 .
    ?class1Instance ex:filterProperty ?filterValue .
    FILTER(?filterValue > 100)  # Your filter condition
    
    # Connection to Class 2
    ?class1Instance ex:predicate1 ?class2Instance .
    ?class2Instance rdf:type ex:Class2 .
    
    # Connection to Class 3
    ?class2Instance ex:predicate2 ?class3Instance .
    ?class3Instance rdf:type ex:Class3 .
    
    # Optional: Additional properties to include in result
    OPTIONAL { ?class1Instance ex:property1 ?value1 }
    OPTIONAL { ?class2Instance ex:property2 ?value2 }
    OPTIONAL { ?class3Instance ex:property3 ?value3 }
}

# Alternative with more complex filtering
CONSTRUCT {
    ?person rdf:type ex:Person .
    ?person ex:worksAt ?company .
    ?company rdf:type ex:Company .
    ?company ex:locatedIn ?city .
    ?city rdf:type ex:City .
    
    ?person ex:name ?personName .
    ?company ex:name ?companyName .
    ?city ex:name ?cityName .
}
WHERE {
    # Filter on Person (Class 1)
    ?person rdf:type ex:Person .
    ?person ex:age ?age .
    FILTER(?age >= 25 && ?age <= 65)
    
    # Connection to Company (Class 2)
    ?person ex:worksAt ?company .
    ?company rdf:type ex:Company .
    ?company ex:industry ?industry .
    FILTER(?industry = "Technology")
    
    # Connection to City (Class 3)
    ?company ex:locatedIn ?city .
    ?city rdf:type ex:City .
    ?city ex:population ?population .
    FILTER(?population > 500000)
    
    # Get additional properties
    ?person ex:name ?personName .
    ?company ex:name ?companyName .
    ?city ex:name ?cityName .
}
