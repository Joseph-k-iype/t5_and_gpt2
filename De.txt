import React from 'react';
import { Handle, Position, NodeProps } from 'reactflow';
import { ChevronDown, ChevronRight } from 'lucide-react';
import { getNodeColor, getNodeIcon } from '@/utils/lineageUtils';

interface CustomNodeData {
  label: string;
  nodeType: 'country' | 'database' | 'attribute';
  country?: string;
  database?: string;
  parent_id?: string;
  data_category?: string;
  is_collapsed: boolean;
  isHighlighted: boolean;
}

const CustomNode: React.FC<NodeProps<CustomNodeData>> = ({ data, id }) => {
  const { label, nodeType, data_category, is_collapsed, isHighlighted } = data;
  const color = getNodeColor(nodeType, isHighlighted);
  const icon = getNodeIcon(nodeType);
  const hasChildren = nodeType === 'country' || nodeType === 'database';

  return (
    <div
      className="custom-node"
      style={{
        background: isHighlighted ? `${color}15` : '#ffffff',
        border: `2px solid ${color}`,
        borderRadius: '8px',
        padding: '12px 16px',
        minWidth: '150px',
        boxShadow: isHighlighted
          ? `0 4px 12px ${color}40`
          : '0 2px 8px rgba(0, 0, 0, 0.1)',
        transition: 'all 0.2s ease',
      }}
    >
      <Handle type="target" position={Position.Top} style={{ opacity: 0 }} />

      <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
        {hasChildren && (
          <div style={{ fontSize: '12px', color: '#64748b' }}>
            {is_collapsed ? <ChevronRight size={16} /> : <ChevronDown size={16} />}
          </div>
        )}
        <div style={{ fontSize: '18px' }}>{icon}</div>
        <div style={{ flex: 1 }}>
          <div
            style={{
              fontSize: '14px',
              fontWeight: 600,
              color: isHighlighted ? color : '#1e293b',
              marginBottom: '2px',
            }}
          >
            {label}
          </div>
          {data_category && (
            <div
              style={{
                fontSize: '11px',
                color: '#64748b',
                fontWeight: 500,
              }}
            >
              {data_category}
            </div>
          )}
        </div>
      </div>

      <Handle type="source" position={Position.Bottom} style={{ opacity: 0 }} />
    </div>
  );
};

export default CustomNode;
