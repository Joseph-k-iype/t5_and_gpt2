import api from './api';

export const chatService = {
  async sendQuickMessage(data) {
    try {
      console.log('üì§ Sending message to backend...');
      
      // For chat messages, we expect longer processing times
      const response = await api.post('/chat/quick', data, {
        timeout: 600000, // 10 minutes timeout for chat
        onUploadProgress: () => {
          console.log('üì° Message sent, waiting for AI processing...');
        }
      });
      
      console.log('‚úÖ Received response from backend');
      return response.data;
    } catch (error) {
      console.error('üí• Chat service error:', error);
      
      // Add more context to errors
      if (error.code === 'ECONNABORTED') {
        error.isResearchTimeout = true;
        console.log('‚è∞ Request timeout - research is taking longer than expected');
      }
      
      throw error;
    }
  },

  async getConversationHistory(sessionId) {
    const response = await api.get(`/chat/conversation/${sessionId}`, {
      timeout: 30000 // Shorter timeout for history
    });
    return response.data;
  },

  async deleteSession(sessionId) {
    const response = await api.delete(`/chat/session/${sessionId}`, {
      timeout: 30000 // Shorter timeout for deletion
    });
    return response.data;
  },
};
