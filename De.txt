"""
Global configuration for the legislation rules converter
Updated with FalkorDB and embedding settings
"""
import os
from openai import OpenAI


class Config:
    """Global configuration"""
    
    # OpenAI API Configuration
    BASE_URL = "https://api.openai.com/v1"
    API_KEY = os.getenv("OPENAI_API_KEY")
    CHAT_MODEL = "o3-mini-2025-01-31"
    EMBEDDING_MODEL = "text-embedding-3-large"  # Direct OpenAI API, no tiktoken
    
    # FalkorDB Configuration
    FALKORDB_HOST = os.getenv("FALKORDB_HOST", "localhost")
    FALKORDB_PORT = int(os.getenv("FALKORDB_PORT", "6379"))
    FALKORDB_GRAPH_NAME = "legal_knowledge_graph"
    
    # Paths
    LEGISLATION_PDF_PATH = "./legislation_pdfs/"
    RULES_OUTPUT_PATH = "./extracted_rules/"
    EMBEDDINGS_PATH = "./embeddings/"
    LOGS_PATH = "./logs/"
    EXISTING_RULES_FILE = "./extracted_rules/all_rules.json"
    METADATA_CONFIG_FILE = "./config/legislation_metadata.json"
    STANDARDS_OUTPUT_PATH = "./standards_output/"
    
    # DPV Namespaces
    DPV_NAMESPACE = "https://w3id.org/dpv#"
    DPV_PD_NAMESPACE = "https://w3id.org/dpv/dpv-pd#"
    DPV_TECH_NAMESPACE = "https://w3id.org/dpv/tech#"
    DPV_LEGAL_NAMESPACE = "https://w3id.org/dpv/legal/"
    ODRL_NAMESPACE = "http://www.w3.org/ns/odrl/2/"
    DPVCG_NAMESPACE = "https://w3id.org/dpv/"
    ACTION_NAMESPACE = "https://w3id.org/dpv/actions#"
    
    # PDF Processing Configuration
    CHUNK_SIZE = 4000
    OVERLAP_SIZE = 300
    MAX_FILE_SIZE = 5 * 1024 * 1024  # 5MB
    
    # Enterprise Tool Recognition
    ENTERPRISE_TOOLS = [
        "DataVisa",
        "DataHub", 
        "PrivacyHub",
        "PrivacyPortal",
        "ComplianceManager"
    ]
    
    # Document Classification Markers (to ignore)
    CLASSIFICATION_MARKERS = [
        "INTERNAL",
        "CONFIDENTIAL",
        "RESTRICTED",
        "PRIVATE",
        "SENSITIVE"
    ]


# Export for backward compatibility
OPENAI_MODEL = Config.CHAT_MODEL
API_KEY = Config.API_KEY
BASE_URL = Config.BASE_URL
EMBEDDING_MODEL = Config.EMBEDDING_MODEL


def get_openai_client() -> OpenAI:
    """
    Get OpenAI client instance
    
    Returns:
        OpenAI: Configured client
        
    Raises:
        ValueError: If API key not set
    """
    if not Config.API_KEY:
        raise ValueError(
            "OPENAI_API_KEY environment variable required. "
            "Set it using: export OPENAI_API_KEY='your-api-key'"
        )
    
    return OpenAI(
        api_key=Config.API_KEY,
        base_url=Config.BASE_URL
    )
