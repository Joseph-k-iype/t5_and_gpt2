import os
import logging
import shutil
from pathlib import Path

def save_enhancement_ui_template():
    """
    Save the enhancement UI HTML template to the templates directory.
    
    This function is meant to be called during application startup to ensure
    the enhancement UI template is available.
    """
    # Get the logger
    logger = logging.getLogger(__name__)
    
    # Set up templates directory
    templates_dir = os.path.join(os.path.dirname(os.path.dirname(os.path.dirname(__file__))), "templates")
    os.makedirs(templates_dir, exist_ok=True)
    
    # Path for the enhancement UI template
    ui_template_path = os.path.join(templates_dir, "enhancement_ui.html")
    
    # Check if we need to create the template file
    if not os.path.exists(ui_template_path):
        logger.info(f"Enhancement UI template not found at {ui_template_path}. Creating template file.")
        try:
            # Path to the source HTML file in the repository
            # This assumes you've saved your HTML file in a specific location
            # Update this path as needed
            source_path = os.path.join(
                os.path.dirname(os.path.dirname(os.path.dirname(__file__))), 
                "static", 
                "enhancement_ui.html"
            )
            
            if os.path.exists(source_path):
                # Copy the file
                shutil.copy2(source_path, ui_template_path)
                logger.info(f"Copied enhancement UI template from {source_path} to {ui_template_path}")
            else:
                logger.warning(f"Source template not found at {source_path}. Template will need to be created manually.")
                
                # Create an empty file as a fallback
                with open(ui_template_path, 'w', encoding='utf-8') as f:
                    f.write("<!-- Enhancement UI template - please add HTML content -->")
                logger.info(f"Created empty enhancement UI template at {ui_template_path}")
                
        except Exception as e:
            logger.error(f"Error creating enhancement UI template: {e}")
    else:
        logger.debug(f"Enhancement UI template already exists at {ui_template_path}")
