graph TB
    subgraph "Developer Workflow"
        DEV_LOCAL[Developer<br/>Local Environment]
        IDE[VS Code / IntelliJ]
        GIT_CLI[Git CLI]
        
        DEV_LOCAL --> IDE
        IDE --> GIT_CLI
    end

    subgraph "GitHub Repository"
        MAIN[Main Branch<br/>Production]
        DEV_BRANCH[Dev Branch<br/>Development]
        FEATURE[Feature Branches<br/>feature/*]
        PR[Pull Request<br/>Code Review]
        
        FEATURE --> PR
        PR --> DEV_BRANCH
        DEV_BRANCH --> MAIN
    end

    subgraph "CI Pipeline - GitHub Actions"
        TRIGGER[Workflow Trigger<br/>on: push/pull_request]
        LINT[Code Linting<br/>ESLint/Pylint]
        TEST[Unit Tests<br/>pytest/Jest]
        SECURITY[Security Scan<br/>Trivy/Snyk]
        SONAR[Code Quality<br/>SonarQube]
        
        TRIGGER --> LINT
        LINT --> TEST
        TEST --> SECURITY
        SECURITY --> SONAR
    end

    subgraph "Build Pipeline"
        DOCKER_BUILD[Docker Build<br/>Multi-stage Build]
        SCAN_IMAGE[Image Scan<br/>Container Analysis]
        PUSH_GCR[Push to GCR<br/>gcr.io/project/app:tag]
        SIGN[Binary Auth<br/>Sign Image]
        
        SONAR --> DOCKER_BUILD
        DOCKER_BUILD --> SCAN_IMAGE
        SCAN_IMAGE --> PUSH_GCR
        PUSH_GCR --> SIGN
    end

    subgraph "Infrastructure Pipeline"
        TF_VALIDATE[Terraform Validate]
        TF_PLAN[Terraform Plan<br/>Generate Plan]
        TF_COST[Cost Estimation<br/>Infracost]
        APPROVAL[Manual Approval<br/>Required for Prod]
        TF_APPLY[Terraform Apply<br/>Provision Resources]
        
        TF_VALIDATE --> TF_PLAN
        TF_PLAN --> TF_COST
        TF_COST --> APPROVAL
        APPROVAL --> TF_APPLY
    end

    subgraph "CD Pipeline - ArgoCD"
        SYNC_DETECT[Detect Changes<br/>Git Poll]
        K8S_MANIFEST[Update Manifests<br/>Kustomize/Helm]
        HEALTH_CHECK[Health Check<br/>Readiness Probes]
        ROLLOUT[Progressive Rollout<br/>Canary/Blue-Green]
        
        SIGN --> SYNC_DETECT
        SYNC_DETECT --> K8S_MANIFEST
        K8S_MANIFEST --> HEALTH_CHECK
        HEALTH_CHECK --> ROLLOUT
    end

    subgraph "GCP Network Architecture"
        subgraph "VPC: arch-team-vpc"
            subgraph "Region: us-central1"
                SUBNET_DEV[Subnet: dev-subnet<br/>10.0.0.0/16]
                SUBNET_PROD[Subnet: prod-subnet<br/>10.2.0.0/16]
                
                subgraph "GKE Cluster: arch-team-gke"
                    POD_CIDR[Pod CIDR<br/>10.100.0.0/14]
                    SVC_CIDR[Service CIDR<br/>10.104.0.0/20]
                    
                    MASTER[GKE Master<br/>Managed by Google]
                    NODES[Worker Nodes<br/>Private IPs]
                    INGRESS[Ingress Controller<br/>nginx/GKE Ingress]
                end
            end
            
            FW_ALLOW[Firewall Rules<br/>Allow HTTP/HTTPS]
            FW_DENY[Firewall Rules<br/>Deny All by Default]
            CLOUD_NAT[Cloud NAT<br/>Outbound Internet]
            CLOUD_ARMOR[Cloud Armor<br/>DDoS Protection]
        end
        
        PRIVATE_CONN[Private Service Connect<br/>Managed Services]
        VPC_PEER[VPC Peering<br/>Cross-Project]
    end

    subgraph "Deployment Targets"
        subgraph "Development Environment"
            DEV_GKE[GKE Namespace: dev]
            DEV_DB[Cloud SQL: dev-instance]
            DEV_CACHE[Redis: dev-cache]
        end
        
        subgraph "Staging Environment"
            STAGE_GKE[GKE Namespace: staging]
            STAGE_DB[Cloud SQL: staging-instance]
            STAGE_CACHE[Redis: staging-cache]
        end
        
        subgraph "Production Environment"
            PROD_GKE[GKE Namespace: production]
            PROD_DB[Cloud SQL: prod-instance]
            PROD_CACHE[Redis: prod-cache]
            PROD_NEO4J[Neo4j: prod-graph]
        end
    end

    subgraph "Post-Deployment"
        SMOKE_TEST[Smoke Tests<br/>API Health Checks]
        E2E_TEST[E2E Tests<br/>Cypress/Selenium]
        METRICS[Metrics Validation<br/>Error Rate < 1%]
        ROLLBACK[Auto Rollback<br/>on Failure]
        NOTIFY[Notifications<br/>Slack/Email]
        
        ROLLOUT --> SMOKE_TEST
        SMOKE_TEST --> E2E_TEST
        E2E_TEST --> METRICS
        METRICS --> ROLLBACK
        METRICS --> NOTIFY
    end

    subgraph "Monitoring & Alerting"
        PROM[Prometheus<br/>Metrics Collection]
        GRAF[Grafana<br/>Dashboards]
        ALERT_MGR[Alert Manager<br/>Alert Routing]
        ONCALL[PagerDuty/Opsgenie<br/>On-Call Rotation]
        
        PROD_GKE -.-> PROM
        PROM --> GRAF
        PROM --> ALERT_MGR
        ALERT_MGR --> ONCALL
    end

    subgraph "Security & Compliance"
        WI_FED[Workload Identity<br/>Federation]
        VAULT[Secret Manager<br/>Credentials]
        AUDIT[Audit Logs<br/>Compliance]
        BINARY_AUTH[Binary Authorization<br/>Signed Images Only]
        
        WI_FED --> VAULT
        ROLLOUT --> BINARY_AUTH
        TF_APPLY -.-> AUDIT
    end

    %% Connections
    GIT_CLI --> FEATURE
    PR --> TRIGGER
    DEV_BRANCH --> TRIGGER
    MAIN --> TRIGGER
    
    TF_APPLY --> SUBNET_DEV
    TF_APPLY --> SUBNET_PROD
    
    ROLLOUT --> DEV_GKE
    ROLLOUT --> STAGE_GKE
    ROLLOUT --> PROD_GKE
    
    INGRESS --> FW_ALLOW
    NODES --> CLOUD_NAT
    
    DEV_GKE --> DEV_DB
    STAGE_GKE --> STAGE_DB
    PROD_GKE --> PROD_DB
    PROD_GKE --> PROD_NEO4J

    %% Styling
    style MAIN fill:#34A853,stroke:#333,stroke-width:3px
    style PROD_GKE fill:#EA4335,stroke:#333,stroke-width:3px
    style BINARY_AUTH fill:#FBBC04
    style ROLLBACK fill:#EA4335
    style APPROVAL fill:#FBBC04
    style CLOUD_ARMOR fill:#4285F4
    style WI_FED fill:#34A853
